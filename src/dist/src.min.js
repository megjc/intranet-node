function closeBtn(){function e(e,t,n,i){function r(e){var n=t.parent(),i=n[0].className;-1!=i.indexOf("modal")?n.removeClass("is-active"):n.addClass("hide")}t.bind("click",r)}var t={link:e,restrict:"A"};return t}function hdAutoComplete(e,t){function n(n,i,r,o){function s(e){n.query=e.name,n.show=!n.show,t.$broadcast("selected",n.query)}function c(){i[0].querySelector("results"),i.find("input");n.query.length>4?e.get("/api/users/search?q="+n.query).then(function(e){e.data.length>0&&(n.show=!n.show,n.results=e.data)})["catch"](function(e){console.log(e)}):(n.show=!1,n.results=[],t.$broadcast("unselected",{}))}i.bind("keyup",c);var a=i.find("input");a.on("blur",function(){console.log("exit")}),n.select=s,n.$on("submitted",function(e,t){n.query=""})}function i(){return'<div class="field autocomplete"><p class="control"><label class="label">My name is:</label><input class="input" type="text" placeholder="e.g. john brown" ng-model="query"><div class="results" ng-show="show"><p ng-repeat="result in results" ng-click="select(result)">{{result.name}}</p></div>'}var r={restrict:"E",link:n,scope:{data:"="},template:i()};return r}!function(){"use strict";function e(e,t){t.interceptors.push("interceptor"),t.interceptors.push("tokenInterceptor"),e.otherwise({redirectTo:"/users/login"})}function t(e){e.$on("$routeChangeSuccess",function(t,n,i){e.title=n.title})}function n(e,t,n){e.$on("$routeChangeStart",function(e,t,i){null!=t.access&&t.access.restricted&&n.validateToken().then(function(e){401==e.status&&n.handleUnAuthorized()})})}e.$inject=["$routeProvider","$httpProvider"],t.$inject=["$rootScope"],n.$inject=["$rootScope","$location","login"],angular.module("intranet",["ngRoute","ngMessages","apps.help","apps.cea","core.admin","core.services","core.interceptors","core.filters","core.login","core.nav","core.search","core.dashboard","apps.tod"]).config(e).run(t).run(n)}(),function(){"use strict";function e(e){e.when("/admin",{controller:"Admin",controllerAs:"vm",templateUrl:"views/core/admin/index.html",title:"Administration",access:{restricted:!0}}).when("/admin/users/ldap",{controller:"LDAPUser",controllerAs:"vm",templateUrl:"views/core/admin/ldap-users.html",title:"Administration",resolve:{ldap_users:["admin",function(e){return e.getLDAPUsers()}]},access:{restricted:!0}}).when("/admin/users",{controller:"User",controllerAs:"vm",templateUrl:"views/core/admin/users.html",title:"Administration",resolve:{users:["admin",function(e){return e.getUsers()}]},access:{restricted:!0}}).when("/admin/users/ldap/:dn",{controller:"Profile",controllerAs:"vm",templateUrl:"views/core/admin/profile.html",title:"Administration",resolve:{users:["admin",function(e){return e.getUsers()}]},access:{restricted:!0}})}function t(e,t,n){e.$on("$routeChangeStart",function(e,i,r){var o=t.path();-1!=o.indexOf("admin")&&n.isAdmin().then(function(e){401==e.status&&t.url("/dashboard/apps")})})}e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","login"],angular.module("core.admin",[]).config(e).run(t)}(),function(){"use strict";function e(e){e.when("/users/login",{templateUrl:"views/login/form.html",controller:"Login as vm",title:"Login ",access:{restricted:!1}}).otherwise({redirectTo:"/users/login"})}e.$inject=["$routeProvider"],angular.module("core.login",[]).config(e)}(),function(){"use strict";function e(e){e.when("/dashboard/apps/cea/contract-employees",{controller:"Employee as vm",title:"Contract Employee Administration",templateUrl:"views/apps/cea/employee-list.html",access:{restricted:!0},resolve:{create:["permission",function(e){return e.getByType("create")}],read:["permission",function(e){return e.getByType("read")}],update:["permission",function(e){return e.getByType("update")}],employees:["employeeSrv",function(e){return e.list()}]}}).when("/dashboard/apps/cea/new/employee",{controller:"CreateEmployee as vm",title:"New Employee",templateUrl:"views/apps/cea/create-employee.html",access:{restricted:!0}})}e.$inject=["$routeProvider"],angular.module("apps.cea",[]).config(e)}(),function(){"use strict";function e(e){e.when("/dashboard/apps",{controller:"Dashboard as vm",templateUrl:"views/dashboard/app-list.html",title:"Dashboard",resolve:{apps:["dashSrv",function(e){return e.getUserAppList()}]},access:{restricted:!0}})}e.$inject=["$routeProvider"],angular.module("core.dashboard",[]).config(e)}(),function(){"use strict";function e(e){e.when("/help-desk",{controller:"Help as vm",templateUrl:"templates/help-desk/form.html",title:"My Help Desk"})}e.$inject=["$routeProvider"],angular.module("apps.help",[]).config(e)}(),function(){"use strict";angular.module("core.nav",[])}(),function(){"use strict";function e(e){e.when("/dashboard/apps/search",{templateUrl:"views/search/searchResults.html",controller:"Search as vm",title:"Search ",access:{restricted:!0}})}e.$inject=["$routeProvider"],angular.module("core.search",[]).config(e)}(),function(){"use strict";function e(e){e.when("/dashboard/apps/tod/expired-docs",{templateUrl:"views/apps/tod/expires-list.html",controller:"ExpiryList as vm",title:"Expired Documents",resolve:{officers:["todSrv",function(e){return e.getExpiredDocs()}],create:["permission",function(e){return e.getByType("create")}],read:["permission",function(e){return e.getByType("read")}],update:["permission",function(e){return e.getByType("update")}]},access:{restricted:!0}}).when("/dashboard/apps/tod/officers",{templateUrl:"views/apps/tod/officer-listing.html",controller:"OfficerList as vm",title:"Officer Listing",resolve:{officers:["todSrv",function(e){return e.getOfficers()}],create:["permission",function(e){return e.getByType("create")}],read:["permission",function(e){return e.getByType("read")}],update:["permission",function(e){return e.getByType("update")}]},access:{restricted:!0}}).when("/dashboard/apps/tod/officers/new",{templateUrl:"views/apps/tod/create-officer.html",controller:"Officer as vm",title:"Add New Officer",resolve:{allowances:["todSrv",function(e){return e.getAllowances()}],classifications:["todSrv",function(e){return e.getClassifications()}],activities:["todSrv",function(e){return e.getActivities()}]},access:{restricted:!0}}).when("/dashboard/apps/tod/officers/:id/edit",{templateUrl:"views/apps/tod/edit-officer.html",controller:"EditOfficer as vm",title:"Edit Officer",access:{restricted:!0},resolve:{allowances:["todSrv",function(e){return e.getAllowances()}],classifications:["todSrv",function(e){return e.getClassifications()}],activities:["todSrv",function(e){return e.getActivities()}]}}).otherwise({redirectTo:"/login"})}e.$inject=["$routeProvider"],angular.module("apps.tod",[]).config(e)}(),function(){"use strict";function e(){function e(){console.log("Admin")}e()}angular.module("core.admin").controller("Admin",e)}(),function(){"use strict";function e(e,t){function n(){r.users=t}function i(t){e.path("/admin/users/ldap/"+t)}var r=this;r.view=i,n()}angular.module("core.admin").controller("LDAPUser",e),e.$inject=["$location","ldap_users"]}(),function(){"use strict";function e(e,t,n,i){function r(){c.access=n.appList(),c.user=n.extractNameFromDN(t.dn),c.department=n.extractDepartmentFromDN(t.dn),n.getApps(t.dn).then(function(e){c.apps=e.data})}function o(){c.show=!c.show}function s(){var e=0;if(angular.forEach(c.access,function(t,n){1==t&&(e++,c.accessList.push(n))}),e>0){var s={uname:c.user,dn:t.dn};n.addUser(s).then(function(e){for(var t=e.data.id,s={uid:t},a=0;a<c.accessList.length;a++)s.app_name=c.accessList[a],n.grantAccess(s).then(function(e){o(),c.message=e.data,i.emitEvent("notification"),r()})})}}var c=this;c.toggle=o,c.show=!1,c.save=s,c.accessList=[],c.message={},r(),i.subscribe(e,"notification",function(){c.notification={text:c.message.message,success:c.message.success,show:!0}})}angular.module("core.admin").controller("Profile",e),e.$inject=["$scope","$routeParams","admin","notify"]}(),function(){"use strict";function e(e){function t(){n.users=e}var n=this;t()}angular.module("core.admin").controller("User",e),e.$inject=["users"]}(),function(){"use strict";function e(e){function t(){return e.get("/api/users/ldap").then(function(e){return e.data})}function n(){return e.get("/api/users").then(function(e){return e.data})}function i(t){return e.get("/api/apps/"+t)}function r(e){var t=e.split(","),n=t[0],i=n.split("=");return i[1]}function o(e){var t=e.split(","),n=t[1].split("=");return n[1].toUpperCase()}function s(t){return e.post("/api/apps/grant_access",t)}function c(){return{"traveling officer database":!1}}function a(t){return e.post("/api/users",t)}var u={getLDAPUsers:t,getUsers:n,getApps:i,extractNameFromDN:r,extractDepartmentFromDN:o,grantAccess:s,appList:c,addUser:a};return u}angular.module("core.admin").service("admin",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,n,i,r,o,s){function c(){u(r.session_expired),0!=o.getToken()&&o.validateToken().then(function(t){t.data?e.path("/dashboard/apps"):e.path("/users/login")})}function a(){var t="/dashboard/apps";o.authUser(l.credentials).then(function(n){l.message=n.data,s.emitEvent("notification"),o.setToken(n.data.token),n.data.success&&i(function(){void 0!==r.redirectTo&&(t=decodeURI(r.redirectTo)),e.search(""),e.path(t)},500)})["catch"](function(e,t,i,r){delete n.sessionStorage.uid})}function u(e){var t="Your session has expired. Please enter your username and password.";void 0!==e&&"true"==e&&(l.notification=s.builder(t,!1,!0),s.emitEvent("notification"))}var l=this;l.credentials=o.initUser(),l.auth=a,c(),s.subscribe(t,"notification",function(){l.notification=s.builder(l.message.message,l.message.success,!0)})}angular.module("core.login").controller("Login",e),e.$inject=["$location","$scope","$window","$timeout","$routeParams","login","notify"]}(),function(){"use strict";function e(e,t,n){function i(){var e=encodeURI(t.path());sessionStorage.removeItem("uid"),t.url("/users/login?session_expired=true&redirectTo="+e)}function r(t){return e.post("/api/users/auth/ldap",t)}function o(){return{name:"",password:""}}function s(){var e=n.sessionStorage.token;return null==e||0==e.length?!1:e}function c(e){null==e&&0==e.length||(n.sessionStorage.uid=e)}function a(){var t={method:"GET",url:"/api/token/verify",headers:{Authorization:"Bearer "+n.sessionStorage.uid}};return e(t)}function u(){delete n.sessionStorage.uid}function l(){return e.get("/api/users/me")}function d(){return e.get("/api/users/admin")}var f={authUser:r,initUser:o,getToken:s,setToken:c,validateToken:a,deleteToken:u,getUname:l,isAdmin:d,handleUnAuthorized:i};return f}angular.module("core.login").service("login",e),e.$inject=["$http","$location","$window"]}(),function(){"use strict";function e(){function e(){console.log("create")}e()}angular.module("apps.cea").controller("CreateEmployee",e)}(),function(){"use strict";function e(e,t,n,i,r,o){function s(){}var c=this;s(),c.canCreate=e,c.canRead=t,c.canUpdate=n,c.employees=i}angular.module("apps.cea").controller("Employee",e),e.$inject=["create","read","update","employees","permission","employeeSrv"]}(),function(){"use strict";function e(e){function t(){return e.get("/api/employees?type=contract").then(function(e){return e.data})}var n={list:t};return n}angular.module("apps.cea").service("employeeSrv",e),e.$inject=["$http"]}(),angular.module("core.directives",[]).directive("closeBtn",closeBtn),function(){"use strict";function e(){return function(e){return e.charAt(0).toUpperCase()}}function t(){return function(e,t,n){return e===t?n:e}}angular.module("core.filters",[]).filter("charAt",e).filter("replaceWith",t)}(),function(){"use strict";angular.module("core.interceptors",[])}(),function(){"use strict";function e(){function e(e){return e.status>=400?e:void 0}var t={responseError:e};return t}angular.module("core.interceptors").factory("interceptor",e)}(),function(){"use strict";function e(e,t){function n(e){var n=t.path();return-1==n.indexOf("login")&&(e.headers.Authorization="Bearer "+sessionStorage.getItem("uid")),e}function i(t){return e.reject(t)}var r={request:n,responseError:i};return r}angular.module("core.interceptors").factory("tokenInterceptor",e),e.$inject=["$q","$location"]}(),function(){"use strict";angular.module("core.services",[])}(),function(){"use strict";function e(e){function t(t,n,i){var r=e.$on(n,i);t.$on("$destroy",r)}function n(t){e.$emit(t)}function i(e,t,n){return{text:e,success:t,show:n}}var r={subscribe:t,emitEvent:n,builder:i};return r}angular.module("core.services").service("notify",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e){function t(t){var n=sessionStorage.getItem("_ai")||0;return e.get("/api/apps/"+n+" /permissions?type="+t).then(function(e){return e.data})}var n={getByType:t};return n}angular.module("core.services").service("permission",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(){i.apps=e}function n(e){sessionStorage.setItem("_ai",e)}var i=this;i.setAppId=n,t()}angular.module("core.dashboard").controller("Dashboard",e),e.$inject=["apps"]}(),function(){"use strict";function e(e){function t(){return e.get("/api/apps").then(function(e){return e.data})}var n={getUserAppList:t};return n}angular.module("core.dashboard").service("dashSrv",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,n){function i(){c.ticket=n.initializeTicket(),c.ticket_types=n.getTicketTypes(),c.requests=n.getRequestTypes(c.ticket_types)}function r(){n.createTicket(c.ticket).then(function(e){c.message={success:e.data.success,text:e.data.text,show:!0},1==e.data.success&&(c.ticket=n.initializeTicket(),c.type="",t.ticketSubForm.$setUntouched())})["catch"](function(e){c.message=n.showError()}),e()}function o(){c.ticket=n.initializeTicket()}function s(e){c.ticket.type_id=e.id}var c=this;c.submit=r,c.cancel=o,c.select=s,i()}angular.module("apps.help").controller("Help",e),e.$inject=["$anchorScroll","$scope","helpService"]}(),angular.module("apps.help").directive("hdAutoComplete",hdAutoComplete),hdAutoComplete.$inject=["$http","$rootScope"],function(){"use strict";function e(e){function t(t){return e.post("/api/validate",{email:t})}function n(){return{description:"",type_id:"",email:""}}function i(e){}function r(){return[{id:1,title:"software issue"},{id:2,title:"general computer issue"},{id:4,title:"internet issue"},{id:5,title:"printer issue"},{id:6,title:"phone issue (CUG or desk phone)"},{id:7,title:"unknown issue"},{id:8,title:"setting up a new employee"},{id:9,title:"making a change to the Ministry's website"},{id:10,title:"setting up/configuring a closed user group cell phone"},{id:11,title:"creating a custom application for our division/branch"},{id:12,title:"setting up a projector/public announcement system"},{id:13,title:"providing support at an event/meeting"},{id:14,title:"other"}]}function o(e){return e.slice(6)}function s(e){return{success:!1,message:"Please review the form for errors"}}function c(t){return""==t.description&&(t.description="no description provided by user"),e.post("/api/tickets",t)}function a(){return{error:!0,text:"We are unable to submit your issue at this time.",show:!0}}var u={initializeTicket:n,isEmpty:i,getTicketTypes:r,getRequestTypes:o,showMessage:s,createTicket:c,showError:a,validate:t};return u}angular.module("apps.help").service("helpService",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){function n(){t.getUname().then(function(e){r.username=e.data})}function i(){t.deleteToken(),e.url("/users/login")}var r=this;r.logout=i,n()}angular.module("core.nav").controller("Nav",e),e.$inject=["$location","login"]}(),function(){"use strict";function e(e,t){function n(){var n=t.q||"";"undefined"==typeof n&&""==n||e.get("/api/search?app=1&q="+n).then(function(e){i.results=e.data})["catch"](function(e){i.resuls=[]})}var i=this;n()}angular.module("core.search").controller("Search",e),e.$inject=["$http","$routeParams"]}(),function(){"use strict";function e(e,t,n,i,r,o){function s(){f.allowances=e,f.classifications=t,f.activities=n}function c(e){o.createOfficer(f.officer).then(function(t){f.message=t,e.$setPristine(),t.success&&(f.officer=o.initOfficerForm(),f.selectedClassification="",f.selectedAllowance="",f.selectedActivity=""),r.emitEvent("notification")})}function a(){f.officer.classification_id=f.selectedClassification}function u(){switch(f.officer.allowance_type=f.selectedAllowance,f.selectedAllowance){case 1:case 3:case 5:case 7:case 11:case 13:case 15:case 17:case 19:f.toggleBox=!f.toggleBox,f.officer.vehicle_required=!0,f.vehicle_details_required=!0;break;default:f.toggleBox=!1}}function l(){f.officer.activity_id=f.selectedActivity}function d(){f.showPermissionDate=!f.showPermissionDate,f.officer.is_owner||(f.permissionRequired=!f.permissionRequired)}var f=this;f.save=c,f.officer=o.initOfficerForm(),f.getSelected=a,f.getSelectedActivity=l,f.getSelectedAllowance=u,f.toggle=d,f.showPermissionDate=!1,f.toggleBox=!1,f.vehicle_details_required=!1,f.permissionRequired=!1,s(),r.subscribe(i,"notification",function(){f.notification=r.builder(f.message.message,f.message.success,!0)})}angular.module("apps.tod").controller("Officer",e),e.$inject=["allowances","classifications","activities","$scope","notify","todSrv"]}(),function(){"use strict";function e(e,t,n,i,r,o,s,c){function a(){r.getOfficerById(n.id).then(function(e){h.officer=e,h.classifications=s,h.allowances=o,h.activities=c,h.selectedClassification=u("id",e.classification_id,s),h.selectedAllowance=u("id",e.allowance_type,o),h.selectedActivity=u("id",e.activity_id,c),e.docs.length>0&&(h.officer.license=new Date(e.docs[0].expiry_date),h.officer.fitness=new Date(e.docs[1].expiry_date),h.officer.registration=new Date(e.docs[2].expiry_date),h.officer.insurance=new Date(e.docs[3].expiry_date))})}function u(e,t,n){for(var i=0,r=!1;i<n.length;i++)if(n[i].hasOwnProperty(e)&&(r=n[i],r[e]==t))return r}function l(e){r.update(h.officer,e,null,null).then(function(e){h.message=e,i.emitEvent("notification")})}function d(){h.officer.activity_id=h.selectedActivity.id}function f(){h.officer.allowance_type=h.selectedAllowance.id}function p(){r.updateVehicle(h.officer).then(function(e){h.message=e,i.emitEvent("notification")})}function m(e,t,n){var o={employee_id:n,expiry_date:t,id:e};r.updateDoc(o).then(function(e){h.message=e,i.emitEvent("notification")})}var h=this;h.update=l,a(),h.updateDoc=m,h.updateVehicle=p,h.getSelectedActivity=d,h.getSelectedAllowance=f,i.subscribe(t,"notification",function(){h.notification={success:h.message.success,text:h.message.text,show:!0}})}angular.module("apps.tod").controller("EditOfficer",e),e.$inject=["$window","$scope","$routeParams","notify","todSrv","allowances","classifications","activities"]}(),function(){"use strict";function e(e,t,n,i,r,o){function s(){c.canCreate=n,c.canRead=i,c.canUpdate=r,c.officers=t}var c=this;s()}angular.module("apps.tod").controller("ExpiryList",e),e.$inject=["$location","officers","create","read","update","todSrv"]}(),function(){"use strict";function e(e,t,n,i,r,o){function s(){d.officers=o}function c(e){i.getDocsByOfficerId(e).then(function(t){a(e),f.push(e),d.documents=t.data})}function a(e){0!=f.length?(u(),document.getElementById(e).classList.toggle("show")):document.getElementById(e).classList.toggle("show")}function u(){for(var e,t=0;t<f.length;t++)e=document.getElementById(f[t]),e.classList.contains("show")&&e.classList.remove("show")}function l(){"undefined"!=typeof d.query&&r.url("/dashboard/apps/search?q="+d.query)}var d=this;d.showDocs=c,d.showModal=!1,d.query="",d.search=l;var f=[];d.canCreate=e,d.canRead=t,d.canUpdate=n,s(),window.onclick=function(e){e.target.matches(".src")||u()}}angular.module("apps.tod").controller("OfficerList",e),e.$inject=["create","read","update","todSrv","$location","officers"]}(),function(){"use strict";function e(e){function t(){return e.get("/api/employees").then(function(e){return e.data})}function n(t){return e.get("/api/employees/"+t+"/documents")}function i(){return!1}function r(t){return e.post("/api/employees?traveling=true",t).then(function(e){return e.data})}function o(){return e.get("/api/allowances").then(function(e){return e.data})}function s(){return e.get("/api/classifications").then(function(e){return e.data})}function c(){return{name:"",email:"",classification:"",allowance_type:"",position:"",activity_id:"",insurance:new Date,registration:new Date,license:new Date,fitness:new Date,permission_date:new Date,is_owner:!0,comment:"",vehicle_required:!1}}function a(){return e.get("/api/activities").then(function(e){return e.data})}function u(t){return e.get("/api/employees/"+t).then(function(e){return e.data})}function l(e){return{id:e.id,name:e.name,email:e.email,position:e.position,classification_id:e.classification_id,activity_id:e.activity_id,allowance_type:e.allowance_type}}function d(e){return{id:e.vehicle_id,plate:e.plate,make:e.make,model:e.model,year:e.vehicle_year}}function f(t,n,i,r){var o={},s="/api/employees/"+t.id;return"employee"==n&&(o=l(t)),e.put(s,o).then(function(e){return e.data})}function p(t){var n=d(t);return e.put("/api/vehicles/"+t.vehicle_id,n).then(function(e){return e.data})}function m(t){return e.put("/api/documents/"+t.id,t).then(function(e){return e.data})}function h(){return e.get("/api/expired").then(function(e){return e.data})}var g={getOfficers:t,getDocsByOfficerId:n,initModal:i,createOfficer:r,getAllowances:o,getClassifications:s,initOfficerForm:c,getActivities:a,getOfficerById:u,update:f,updateDoc:m,getExpiredDocs:h,updateVehicle:p};return g}angular.module("apps.tod").service("todSrv",e),e.$inject=["$http"]}();